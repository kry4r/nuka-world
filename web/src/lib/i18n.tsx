"use client";

import { createContext, useContext, useState, useCallback, type ReactNode } from "react";

export type Locale = "en" | "zh";

const translations: Record<Locale, Record<string, string>> = {
  en: {
    // Sidebar
    "nav.dashboard": "dashboard",
    "nav.residents": "residents",
    "nav.chat": "chat",
    "nav.memory": "memory_graph",
    "nav.teams": "teams",
    "nav.providers": "providers",
    "nav.gateway": "gateway",
    "nav.skills": "skills",
    // Dashboard
    "dash.title": "DASHBOARD",
    "dash.subtitle": "World Overview",
    "dash.residents": "RESIDENTS",
    "dash.active": "ACTIVE",
    "dash.world_time": "WORLD TIME",
    "dash.activity": "WORLD ACTIVITY",
    // Residents
    "res.title": "RESIDENTS",
    "res.subtitle": "Agent Management",
    "res.total": "TOTAL",
    "res.active": "ACTIVE",
    "res.idle": "IDLE",
    "res.resting": "RESTING",
    "res.no_agents": "No agents registered yet",
    "res.create": "Create Resident",
    "res.name": "Name",
    "res.role": "Role",
    "res.model": "Model",
    "res.personality": "Personality",
    "res.backstory": "Backstory",
    "res.system_prompt": "System Prompt",
    "res.cancel": "Cancel",
    "res.submit": "Create",
    // Chat
    "chat.title": "CONVERSATIONS",
    "chat.agents": "Agents",
    "chat.teams": "Teams",
    "chat.no_agents": "No agents available",
    "chat.no_teams": "No teams available",
    "chat.select": "Select an agent",
    "chat.placeholder": "Type a message...",
    "chat.send": "Send",
    "chat.thinking": "Thinking...",
    // Teams
    "team.title": "TEAMS",
    "team.subtitle": "Orchestrator Management",
    "team.no_teams": "No teams configured. Requires Redis connection.",
    "team.create": "Create Team",
    "team.name": "Team Name",
    "team.desc": "Description",
    "team.strategy": "Strategy",
    "team.members": "Members",
    "team.cancel": "Cancel",
    "team.submit": "Create",
    // Providers
    "prov.title": "PROVIDERS",
    "prov.subtitle": "LLM Provider Management",
    "prov.status": "STATUS",
    "prov.providers": "PROVIDERS",
    "prov.models": "MODELS",
    "prov.requests": "REQUESTS",
    "prov.token_usage": "TOKEN USAGE",
    "prov.add": "Add Provider",
    "prov.name": "Name",
    "prov.type": "Type",
    "prov.url": "API URL (e.g. https://api.example.com/v1)",
    "prov.token": "Token / API Key",
    "prov.no_providers": "No providers configured",
    "prov.cancel": "Cancel",
    "prov.submit": "Add",
    // Gateway
    "gw.title": "GATEWAY",
    "gw.subtitle": "Adapter Management",
    "gw.status": "STATUS",
    "gw.adapters": "ADAPTERS",
    "gw.connected": "CONNECTED",
    "gw.messages": "MESSAGES",
    "gw.configure": "Configure",
    "gw.add_adapter": "Add Adapter",
    "gw.webhook_url": "Webhook URL",
    "gw.bot_token": "Bot Token",
    "gw.channel": "Channel (e.g. #general)",
    "gw.save_success": "Adapter saved",
    "gw.save_failed": "Failed to save adapter",
    "gw.no_adapters": "No adapters configured",
    "gw.adapter_name": "Adapter Name",
    "gw.adapter_type": "Type",
    // Skills
    "skill.title": "SKILLS",
    "skill.subtitle": "Skill & MCP Management",
    "skill.no_skills": "No skills configured",
    "skill.add": "Add Skill",
    "skill.name": "Skill Name",
    "skill.type": "Type",
    "skill.desc": "Description",
    "skill.endpoint": "Endpoint URL",
    "skill.command": "Command",
    "skill.cancel": "Cancel",
    "skill.submit": "Add",
    "skill.remove": "Remove",
    "skill.type_builtin": "Built-in",
    "skill.type_mcp": "MCP Server",
    "skill.type_custom": "Custom",
    "skill.total": "TOTAL",
    "skill.active": "ACTIVE",
    // MCP
    "mcp.title": "MCP SERVERS",
    "mcp.subtitle": "Model Context Protocol Management",
    "mcp.total": "TOTAL",
    "mcp.active": "ACTIVE",
    "mcp.no_servers": "No MCP servers configured",
    "mcp.add": "Add MCP Server",
    "mcp.name": "Server Name",
    "mcp.endpoint": "Server URL (e.g. http://localhost:3001/sse)",
    "mcp.transport": "Transport",
    "mcp.desc": "Description",
    "mcp.cancel": "Cancel",
    "mcp.submit": "Add",
    "mcp.remove": "Remove",
    // Sidebar
    "nav.mcp": "mcp_servers",
    // Collaboration
    "collab.title": "COLLABORATION",
    "collab.subtitle": "A2A Task Management",
    "collab.no_tasks": "No collaboration tasks yet",
    "collab.create": "New Task",
    "collab.desc": "Task Description",
    "collab.cancel": "Cancel",
    "collab.submit": "Submit",
    "collab.confirm": "Confirm Team",
    "collab.cancel_task": "Cancel Task",
    "collab.proposed": "Proposed Agents",
    "collab.confirmed": "Confirmed Agents",
    "collab.rounds": "Max Rounds",
    "collab.result": "Result",
    "nav.collaboration": "collaboration",
    // Provider extras
    "prov.edit": "Edit",
    "prov.delete": "Delete",
    "prov.test": "Test",
    "prov.default": "Default",
    "prov.set_default": "Set Default",
    "prov.testing": "Testing...",
    "prov.test_ok": "Connection OK",
    "prov.test_fail": "Connection Failed",
    "prov.models_label": "Models (comma separated)",
    "prov.endpoint": "Endpoint URL",
    // Common
    "common.cancel": "Cancel",
    "common.save": "Save",
    "common.delete": "Delete",
    "common.edit": "Edit",
    "common.loading": "Loading...",
  },
  zh: {
    // Sidebar
    "nav.dashboard": "仪表盘",
    "nav.residents": "居民",
    "nav.chat": "对话",
    "nav.memory": "记忆图谱",
    "nav.teams": "团队",
    "nav.providers": "模型供应商",
    "nav.gateway": "网关",
    "nav.skills": "技能",
    // Dashboard
    "dash.title": "仪表盘",
    "dash.subtitle": "世界概览",
    "dash.residents": "居民数",
    "dash.active": "活跃",
    "dash.world_time": "世界时间",
    "dash.activity": "世界动态",
    // Residents
    "res.title": "居民管理",
    "res.subtitle": "Agent 管理",
    "res.total": "总数",
    "res.active": "活跃",
    "res.idle": "空闲",
    "res.resting": "休息",
    "res.no_agents": "暂无注册的 Agent",
    "res.create": "创建居民",
    "res.name": "名称",
    "res.role": "角色",
    "res.model": "模型",
    "res.personality": "性格",
    "res.backstory": "背景故事",
    "res.system_prompt": "系统提示词",
    "res.cancel": "取消",
    "res.submit": "创建",
    // Chat
    "chat.title": "对话列表",
    "chat.agents": "居民",
    "chat.teams": "团队",
    "chat.no_agents": "暂无可用 Agent",
    "chat.no_teams": "暂无可用团队",
    "chat.select": "选择一个 Agent",
    "chat.placeholder": "输入消息...",
    "chat.send": "发送",
    "chat.thinking": "思考中...",
    // Teams
    "team.title": "团队管理",
    "team.subtitle": "编排器管理",
    "team.no_teams": "暂无团队配置，需要 Redis 连接。",
    "team.create": "创建团队",
    "team.name": "团队名称",
    "team.desc": "描述",
    "team.strategy": "策略",
    "team.members": "成员",
    "team.cancel": "取消",
    "team.submit": "创建",
    // Providers
    "prov.title": "模型供应商",
    "prov.subtitle": "LLM 供应商管理",
    "prov.status": "状态",
    "prov.providers": "供应商数",
    "prov.models": "模型数",
    "prov.requests": "请求数",
    "prov.token_usage": "Token 用量",
    "prov.add": "添加供应商",
    "prov.name": "名称",
    "prov.type": "类型",
    "prov.url": "API 地址（如 https://api.example.com/v1）",
    "prov.token": "Token / API 密钥",
    "prov.no_providers": "暂无供应商配置",
    "prov.cancel": "取消",
    "prov.submit": "添加",
    // Gateway
    "gw.title": "网关管理",
    "gw.subtitle": "适配器管理",
    "gw.status": "状态",
    "gw.adapters": "适配器数",
    "gw.connected": "已连接",
    "gw.messages": "消息数",
    "gw.configure": "配置",
    "gw.add_adapter": "添加适配器",
    "gw.webhook_url": "Webhook 地址",
    "gw.bot_token": "Bot Token",
    "gw.channel": "频道（如 #general）",
    "gw.save_success": "适配器已保存",
    "gw.save_failed": "保存适配器失败",
    "gw.no_adapters": "暂无适配器配置",
    "gw.adapter_name": "适配器名称",
    "gw.adapter_type": "类型",
    // Skills
    "skill.title": "技能管理",
    "skill.subtitle": "技能与 MCP 管理",
    "skill.no_skills": "暂无技能配置",
    "skill.add": "添加技能",
    "skill.name": "技能名称",
    "skill.type": "类型",
    "skill.desc": "描述",
    "skill.endpoint": "端点 URL",
    "skill.command": "命令",
    "skill.cancel": "取消",
    "skill.submit": "添加",
    "skill.remove": "移除",
    "skill.type_builtin": "内置",
    "skill.type_mcp": "MCP 服务",
    "skill.type_custom": "自定义",
    "skill.total": "总数",
    "skill.active": "活跃",
    // MCP
    "mcp.title": "MCP 服务",
    "mcp.subtitle": "模型上下文协议管理",
    "mcp.total": "总数",
    "mcp.active": "活跃",
    "mcp.no_servers": "暂无 MCP 服务配置",
    "mcp.add": "添加 MCP 服务",
    "mcp.name": "服务名称",
    "mcp.endpoint": "服务地址（如 http://localhost:3001/sse）",
    "mcp.transport": "传输方式",
    "mcp.desc": "描述",
    "mcp.cancel": "取消",
    "mcp.submit": "添加",
    "mcp.remove": "移除",
    // Sidebar
    "nav.mcp": "MCP 服务",
    // Collaboration
    "collab.title": "协作任务",
    "collab.subtitle": "A2A 任务管理",
    "collab.no_tasks": "暂无协作任务",
    "collab.create": "新建任务",
    "collab.desc": "任务描述",
    "collab.cancel": "取消",
    "collab.submit": "提交",
    "collab.confirm": "确认组队",
    "collab.cancel_task": "取消任务",
    "collab.proposed": "推荐 Agent",
    "collab.confirmed": "已确认 Agent",
    "collab.rounds": "最大轮次",
    "collab.result": "结果",
    "nav.collaboration": "协作",
    // Provider extras
    "prov.edit": "编辑",
    "prov.delete": "删除",
    "prov.test": "测试",
    "prov.default": "默认",
    "prov.set_default": "设为默认",
    "prov.testing": "测试中...",
    "prov.test_ok": "连接成功",
    "prov.test_fail": "连接失败",
    "prov.models_label": "模型（逗号分隔）",
    "prov.endpoint": "端点地址",
    // Common
    "common.cancel": "取消",
    "common.save": "保存",
    "common.delete": "删除",
    "common.edit": "编辑",
    "common.loading": "加载中...",
  },
};

interface I18nContextType {
  locale: Locale;
  setLocale: (l: Locale) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextType>({
  locale: "en",
  setLocale: () => {},
  t: (k) => k,
});

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocale] = useState<Locale>("en");
  const t = useCallback(
    (key: string) => translations[locale][key] || key,
    [locale],
  );
  return (
    <I18nContext.Provider value={{ locale, setLocale, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  return useContext(I18nContext);
}
